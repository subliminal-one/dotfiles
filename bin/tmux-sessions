#!/usr/bin/env sh

SESSIONS=(
  notes
  project
  wellness-living
)

SESSION=$(printf "%s\n" "${SESSIONS[@]}" | fzf --reverse)
if [ "$SESSION" = "" ]; then
  exit 0
fi

tmux has-session -t $SESSION 2>/dev/null

if [ $? -eq 0 ]; then
  tmux attach-session -t $SESSION
  exit 0
fi

if [ $SESSION == "project" ]; then
  DIR=$(fd '(composer.json|package.json)' ~/projects -E node_modules -x echo {//} | fzf +m --reverse)
  if [ "$DIR" = "" ]; then
    exit 0;
  fi

  NAME=$(basename $DIR)

  tmux has-session -t $NAME 2>/dev/null
  if [ $? -eq 0 ]; then
    tmux attach-session -t $NAME
    exit 0
  fi

  cd $DIR
  tmux new-session -A -s $NAME
  exit 0
fi

if [ $SESSION = "notes" ]; then
  cd ~/Documents/notes
  tmux new-session -d -s "notes"
  tmux send-keys "nvim todo.md" C-m
  tmux new-window
  tmux select-window -t 1
  tmux attach -t "notes"
  exit 0
fi

# Wellness
if [ $SESSION = "wellness-living" ]; then
  tmux has-session -t "wellness-backend"
  if [ $? -eq 1 ]; then
    cd ~/projects/simplyphp/wellness-living/backend
    tmux new-session -s "wellness-backend" -d
    tmux send-keys "nvim" C-m
    tmux new-window
    tmux new-window
    tmux send-keys "docker exec -it backend-laravel.test-1 bash"
    tmux new-window
    tmux move-window -t 9
    tmux send-keys "docker-compose up" C-m
    tmux select-window -t 1
  fi

  tmux has-session -t "wellness-frontend"
  if [ $? -eq 1 ]; then
    cd ~/projects/simplyphp/wellness-living/frontend/
    tmux new-session -d -s "wellness-frontend"
    tmux send-keys "nvim" C-m
    tmux new-window
    tmux new-window
    tmux new-window
    tmux move-window -t 9
    tmux send-keys "npx next dev --hostname=127.0.0.1 --port=3001" C-m
    tmux select-window -t 1
  fi

  tmux has-session -t "wellness-notes"
  if [ $? -eq 1 ]; then
    cd ~/projects/simplyphp/wellness-living/notes/
    tmux new-session -d -s "wellness-notes"
    tmux send-keys "nvim -O2 notes.md scratch.md" C-m
    tmux new-window
    tmux select-window -t 1
  fi

  tmux attach-session -t "wellness-notes"

  exit 0
fi
